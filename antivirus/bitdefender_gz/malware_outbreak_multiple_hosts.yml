- id: 1002
  dataTypes:
    - antivirus-bitdefender-gz
  name: Malware Outbreak Detection - Multiple Hosts Infected
  impact:
    confidentiality: 5
    integrity: 5
    availability: 4
  category: Malware
  technique: T1105 - Ingress Tool Transfer
  adversary: origin
  references:
    - https://www.bitdefender.com/business/support/en/77212-237089-event-types.html
    - https://attack.mitre.org/techniques/T1105/
  description: Detects when the same malware signature or threat is detected on multiple endpoints within a short time window. This pattern indicates a potential malware outbreak spreading across the network environment.
  where: >
    safe(log.eventType, "") == "AntiMalware" &&
    safe(log.severity, "") in ["4", "5"] &&
    safe(log.signatureID, "") != "" &&
    safe(log.dvchost, "") != ""
  afterEvents:
    - indexPattern: v11-log-*
      with:
        - field: log.signatureID.keyword
          operator: filter_term
          value: '{{log.signatureID}}'
        - field: log.eventType.keyword
          operator: filter_term
          value: "AntiMalware"
      within: now-2h
      count: 10
      uniqueField: log.dvchost.keyword
  deduplicateBy:
    - log.signatureID