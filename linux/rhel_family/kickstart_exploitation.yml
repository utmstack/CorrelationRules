- id: 1007
  dataTypes:
    - rhel_family
  name: RHEL Kickstart Configuration Exploitation Attempt
  impact:
    confidentiality: 5
    integrity: 5
    availability: 3
  category: Initial Access
  technique: Supply Chain Compromise
  adversary: origin
  references:
    - https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/9/html/security_hardening/assembly_securing-rhel-during-installation-security-hardening
    - https://attack.mitre.org/techniques/T1195/002/
  description: Detects potential exploitation attempts targeting RHEL Kickstart configurations, including malicious package injection, firewall disabling, unauthorized user creation, or security feature bypass attempts during automated installations.
  where: (safe(log.facility, "") == "daemon" || safe(log.process, "") == "anaconda") && (safe(log.message, "") contains "kickstart" || safe(log.message, "") contains "ks.cfg") && (safe(log.message, "") contains "firewall --disabled" || safe(log.message, "") contains "selinux --disabled" || safe(log.message, "") contains "rootpw --plaintext" || safe(log.message, "") contains "user --password" || safe(log.message, "") contains "repo --baseurl" || safe(log.message, "") contains "auth --enableldap" && safe(log.message, "") contains "ssl"))
  afterEvents:
    - indexPattern: v11-log-*
      with:
        - field: destination.host.keyword
          operator: filter_term
          value: '{{destination.host}}'
      within: now-1h
      count: 3
  deduplicateBy:
    - destination.host
    - log.file