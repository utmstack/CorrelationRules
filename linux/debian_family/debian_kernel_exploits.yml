- id: 1009
  dataTypes:
    - debian_family
  name: Debian-Specific Kernel Exploit Attempts
  impact:
    confidentiality: 5
    integrity: 5
    availability: 5
  category: Privilege Escalation
  technique: Exploitation for Privilege Escalation
  adversary: origin
  references:
    - https://attack.mitre.org/techniques/T1068/
    - https://www.debian.org/security/
    - https://security-tracker.debian.org/tracker/
  description: Detects potential kernel exploitation attempts specific to Debian systems including dirty COW variants, overlayfs exploits, namespace escapes, and other kernel vulnerability exploitation indicators
  where: |
    (safe(log.message, "") contains "kernel" || safe(log.process, "") contains "kernel") &&
    (safe(log.message, "") contains "exploit" ||
     safe(log.message, "") contains "segfault" && safe(log.message, "") contains "ip" && safe(log.message, "") contains "sp" ||
     safe(log.message, "") contains "BUG: unable to handle kernel" ||
     safe(log.message, "") contains "Kernel panic" ||
     safe(log.message, "") contains "Oops:" ||
     safe(log.message, "") contains "overlayfs" && safe(log.message, "") contains "denied" ||
     safe(log.message, "") contains "namespace escape" ||
     safe(log.message, "") contains "capabilities" && safe(log.message, "") contains "denied" ||
     safe(log.message, "") contains "PTRACE" && safe(log.message, "") contains "denied" ||
     safe(log.message, "") contains "dirty cow" ||
     safe(log.message, "") contains "mmap_min_addr" ||
     safe(log.message, "") contains "vsyscall attempted" ||
     safe(log.message, "") contains "stack smashing detected" ||
     safe(log.message, "") contains "buffer overflow detected" ||
     safe(log.message, "") contains "Return-oriented programming" ||
     safe(log.message, "") contains "ROP chain")
  afterEvents:
    - indexPattern: v11-log-*
      with:
        - field: origin.hostname.keyword
          operator: filter_term
          value: '{{origin.hostname}}'
      within: now-5m
      count: 2
  deduplicateBy:
    - origin.hostname
    - origin.ip