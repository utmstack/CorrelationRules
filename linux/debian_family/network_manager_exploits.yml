- id: 1011
  dataTypes:
    - debian_family
  name: Network Manager Exploit Attempt
  impact:
    confidentiality: 4
    integrity: 5
    availability: 4
  category: System Compromise
  technique: Exploitation for Privilege Escalation
  adversary: origin
  references:
    - https://www.debian.org/security/
    - https://attack.mitre.org/techniques/T1068/
  description: Detects potential exploitation attempts against Network Manager service including privilege escalation, D-Bus manipulation, and configuration tampering
  where: |
    (safe(log.process_name, "") == "NetworkManager" && safe(log.event_type, "") in ["segfault", "crash", "error"]) ||
    (safe(log.service, "") == "NetworkManager" && safe(log.message, "") contains_any ["privilege escalation", "unauthorized access", "buffer overflow", "segmentation fault"]) ||
    (safe(log.dbus_interface, "") contains "NetworkManager" && safe(log.error_code, "") != "" && safe(log.action, "") in ["denied", "failed", "unauthorized"]) ||
    (safe(log.file_path, "") contains_any ["/etc/NetworkManager/", "/var/lib/NetworkManager/"] && safe(log.operation, "") in ["modify", "delete", "write"] && safe(log.user, "") != "root")
  afterEvents:
    - indexPattern: v11-log-*
      with:
        - field: origin.ip.keyword
          operator: filter_term
          value: '{{origin.ip}}'
        - field: destination.hostname.keyword
          operator: filter_term
          value: '{{destination.hostname}}'
      within: now-30m
      count: 3
  deduplicateBy:
    - origin.ip
    - destination.hostname