- id: 1030
  dataTypes:
    - firewall-mikrotik
  name: MikroTik Firmware Vulnerability Exploitation Attempt
  impact:
    confidentiality: 5
    integrity: 5
    availability: 5
  category: Exploitation
  technique: Exploit Public-Facing Application
  adversary: origin
  references:
    - https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=mikrotik
    - https://attack.mitre.org/techniques/T1190/
  description: Detects potential exploitation attempts targeting known MikroTik firmware vulnerabilities including buffer overflows, authentication bypasses, remote code execution attempts, or suspicious system calls that may indicate compromise.
  where: |
    (safe(log.topics, "") == "system" || contains(safe(log.topics, ""), "firewall") || contains(safe(log.topics, ""), "critical")) &&
    (contains(lower(safe(log.message, "")), "buffer overflow") ||
     contains(lower(safe(log.message, "")), "segmentation fault") ||
     contains(lower(safe(log.message, "")), "stack overflow") ||
     (contains(lower(safe(log.message, "")), "authentication") && contains(lower(safe(log.message, "")), "bypass")) ||
     contains(lower(safe(log.message, "")), "invalid memory") ||
     contains(lower(safe(log.message, "")), "code injection") ||
     contains(lower(safe(log.message, "")), "command injection") ||
     (contains(lower(safe(log.message, "")), "script") && contains(lower(safe(log.message, "")), "error")) ||
     contains(lower(safe(log.message, "")), "/nova/bin/") ||
     contains(lower(safe(log.message, "")), "jailbreak") ||
     (contains(lower(safe(log.message, "")), "exploit") || contains(lower(safe(log.message, "")), "payload"))) ||
    (safe(log.chain, "") != "" && 
     (contains(lower(safe(log.chain, "")), "input") || contains(lower(safe(log.chain, "")), "forward")) &&
     safe(origin.port, 0) > 0 && 
     (safe(target.port, 0) == 8291 || safe(target.port, 0) == 8728 || safe(target.port, 0) == 8729 || safe(target.port, 0) == 80 || safe(target.port, 0) == 443))
  afterEvents:
    - indexPattern: v11-log-*
      with:
        - field: origin.ip.keyword
          operator: filter_term
          value: '{{origin.ip}}'
      within: now-5m
      count: 5
  deduplicateBy:
    - origin.ip
    - target.port