- id: 1003
  dataTypes:
    - json-input
  name: JSON Parser Exploitation Attempt
  impact:
    confidentiality: 3
    integrity: 4
    availability: 3
  category: Parser Attack
  technique: Parser Exploitation
  adversary: origin
  references:
    - https://bishopfox.com/blog/json-interoperability-vulnerabilities
    - https://attack.mitre.org/techniques/T1055/
  description: Detects attempts to exploit JSON parser vulnerabilities including duplicate keys, serialization discrepancies, number overflow attempts, and parser-specific quirks that could lead to security bypasses.
  where: |
    (safe(log.error, "").contains("duplicate key") ||
     safe(log.error, "").contains("parser error") ||
     safe(log.error, "").contains("deserialization failed") ||
     safe(log.error, "").contains("unexpected token") ||
     safe(log.error, "").contains("maximum depth exceeded") ||
     safe(log.message, "").contains("duplicate JSON key") ||
     safe(log.message, "").contains("parser inconsistency") ||
     safe(log.message, "").contains("conflicting values") ||
     safe(log.parse_errors, 0) > 5 ||
     (safe(log.json_depth, 0) > 100 && safe(log.error, "") != "") ||
     safe(log.numeric_overflow, false) == true) &&
    safe(origin.ip, "") != ""
  afterEvents:
    - indexPattern: v11-log-*
      with:
        - field: origin.ip.keyword
          operator: filter_term
          value: '{{origin.ip}}'
        - field: log.error.keyword
          operator: filter_term
          value: '{{log.error}}'
      within: now-1h
      count: 3
  deduplicateBy:
    - origin.ip
    - log.error