- id: 1013
  dataTypes:
    - mysql
  name: MySQL UDF Exploitation Attempts
  impact:
    confidentiality: 5
    integrity: 5
    availability: 3
  category: Execution
  technique: Command and Scripting Interpreter (T1059)
  adversary: origin
  references:
    - https://dev.mysql.com/doc/refman/8.0/en/create-function-loadable.html
    - https://attack.mitre.org/techniques/T1059/
  description: Detects attempts to create or use User Defined Functions (UDFs) in MySQL which could be used for privilege escalation or code execution
  where: >
    safe(log.msg, "") != "" && 
    (log.msg.contains("CREATE FUNCTION") && (log.msg.contains("SONAME") || log.msg.contains("RETURNS")) ||
     log.msg.contains("DROP FUNCTION") ||
     log.msg.contains("sys_exec") ||
     log.msg.contains("sys_eval") ||
     log.msg.contains("lib_mysqludf_sys") ||
     log.msg.contains("openssl_udf") ||
     log.errorCode == "ER_CANT_FIND_UDF" ||
     log.errorCode == "ER_CANT_CREATE_UDF" ||
     log.msg.contains("UDF") && (log.msg.contains("error") || log.msg.contains("failed")))
  deduplicateBy:
    - origin.host