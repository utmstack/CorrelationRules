- id: 1023
  dataTypes:
    - nats
  name: NATS Resolver Exploitation Detection
  impact:
    confidentiality: 4
    integrity: 3
    availability: 2
  category: Exploitation
  technique: Exploitation for Client Execution
  adversary: origin
  references:
    - https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/jwt
    - https://attack.mitre.org/techniques/T1203/
  description: Detects attempts to exploit NATS resolver functionality including JWT resolver, account resolver, or DNS resolver issues that could lead to authentication bypass or unauthorized access.
  where: |
    safe(log.message, "") contains "resolver error" ||
    safe(log.message, "") contains "resolver failed" ||
    safe(log.message, "") contains "JWT resolver" ||
    safe(log.message, "") contains "account resolver" ||
    safe(log.message, "") contains "DNS resolution failed" ||
    (safe(log.message, "") contains "resolver" && (safe(log.message, "") contains "invalid" || safe(log.message, "") contains "malformed"))
  afterEvents:
    - indexPattern: v11-log-*
      with:
        - field: origin.host.keyword
          operator: filter_term
          value: '{{origin.host}}'
      within: now-15m
      count: 10
  deduplicateBy:
    - origin.host