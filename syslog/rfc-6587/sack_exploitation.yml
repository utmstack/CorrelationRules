- id: 1017
  dataTypes:
    - rfc-6587
  name: TCP SACK Exploitation (SACK Panic)
  impact:
    confidentiality: 0
    integrity: 1
    availability: 5
  category: Network Security
  technique: Denial of Service
  adversary: origin
  references:
    - https://access.redhat.com/security/vulnerabilities/tcpsack
    - https://nvd.nist.gov/vuln/detail/CVE-2019-11477
    - https://attack.mitre.org/techniques/T1499/001/
  description: Detects potential SACK Panic exploitation attempts where attackers send crafted sequences of SACK packets combined with low MSS values to fragment the TCP retransmission queue, causing CPU exhaustion and kernel panics.
  where: |
    safe(origin.ip, "") != "" &&
    safe(log.tcp_options, "") contains "sack" &&
    safe(log.tcp_mss, 0) > 0 && safe(log.tcp_mss, 0) <= 48 &&
    (safe(log.sack_blocks, 0) > 3 || safe(log.tcp_segment_size, 0) < 40)
  afterEvents:
    - indexPattern: v11-log-*
      with:
        - field: origin.ip.keyword
          operator: filter_term
          value: '{{origin.ip}}'
        - field: destination.ip.keyword
          operator: filter_term
          value: '{{destination.ip}}'
        - field: log.tcp_options
          operator: wildcard
          value: '*sack*'
      within: now-1m
      count: 20
  deduplicateBy:
    - origin.ip
    - destination.ip
    - destination.port